{% extends 'main/layout.html' %}

{% block title %}Мои заявки{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Мои заявки</h2>

    <ul class="nav nav-tabs" id="requestTabs" role="tablist">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#testdrives">Тест-драйвы</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#orders">Покупки</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tradeins">Трейд-ин</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#credits">Кредиты</a></li>
    </ul>

    <div class="tab-content mt-3">

        <!-- Тест-драйвы -->
        <div class="tab-pane fade show active" id="testdrives">
            {% if test_drives %}
            <table class="table table-striped table-bordered">
                <thead class="table-light"><tr><th>Автомобиль</th><th>Дата</th><th>Статус</th></tr></thead>
                <tbody>
                    {% for td in test_drives %}
                    <tr class="table-{{ td.get_status_class }}">
                        <td>{{ td.car }}</td>
                        <td>{{ td.date|date:"d.m.Y H:i" }}</td>
                        <td>{{ td.get_status_display }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted">Нет заявок на тест-драйв.</p>
            {% endif %}
        </div>

        <!-- Покупки -->
        <div class="tab-pane fade" id="orders">
            {% if car_orders %}
            <table class="table table-striped table-bordered">
                <thead class="table-light"><tr><th>Автомобиль</th><th>Дата заказа</th><th>Статус</th></tr></thead>
                <tbody>
                    {% for order in car_orders %}
                    <tr>
                        <td>{{ order.car }}</td>
                        <td>{{ order.order_date|date:"d.m.Y" }}</td>
                        <td>{{ order.get_status_display }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted">Нет заказов на покупку автомобиля.</p>
            {% endif %}
        </div>

        <!-- Трейд-ин -->
        <div class="tab-pane fade" id="tradeins">
            {% if trade_ins %}
            <table class="table table-striped table-bordered">
                <thead class="table-light">
                    <tr><th>Авто</th><th>Год</th><th>Пробег</th><th>Желаемый авто</th><th>Статус</th></tr>
                </thead>
                <tbody>
                    {% for t in trade_ins %}
                    <tr>
                        <td>{{ t.current_car_brand }} {{ t.current_car_model }}</td>
                        <td>{{ t.year }}</td>
                        <td>{{ t.mileage }} км</td>
                        <td>{{ t.desired_car }}</td>
                        <td>{{ t.get_status_display }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted">Нет заявок на трейд-ин.</p>
            {% endif %}
        </div>

        <!-- Кредиты -->
        <div class="tab-pane fade" id="credits">
            {% if credit_requests %}
            <table class="table table-striped table-bordered">
                <thead class="table-light">
                    <tr><th>Авто</th><th>Сумма</th><th>Срок</th><th>Статус</th></tr>
                </thead>
                <tbody>
                    {% for c in credit_requests %}
                    <tr>
                        <td>{{ c.car }}</td>
                        <td>{{ c.amount }} ₽</td>
                        <td>{{ c.duration }} мес.</td>
                        <td>{{ c.get_status_display }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-muted">Нет заявок на кредит.</p>
            {% endif %}
        </div>

    </div>
</div>

<!-- Bootstrap tabs script -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
